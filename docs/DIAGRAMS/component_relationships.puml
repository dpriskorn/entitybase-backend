@startuml Component Relationships

title Wikibase Backend - Component Relationships

[FastAPI] as API
[Handlers] as Handlers
[Services] as Services
[Workers] as Workers
[Repositories] as Repos
[Models] as Models
database "Vitess" as Vitess
storage "S3 Terms bucket" as S3Terms
storage "S3 Statements bucket" as S3Statements
storage "S3 References bucket" as S3References
storage "S3 Qualifiers bucket" as S3Qualifiers
storage "S3 Revisions bucket" as S3Revisions
storage "S3 Dumps bucket" as S3Dumps
queue "Kafka" as Kafka
[Config] as Config

() "HTTP API" as HTTP
() "Database Interface" as DBI
() "Storage Interface" as SI
() "Kafka Message Queue" as MQ

' Architecture layers
API --> Handlers : routes
Handlers --> Services : logic
Services --> Repos : data
Workers --> Repos : processing
Services --> Models : serialization

' External interfaces
API -- HTTP
Repos -- DBI
Services -- SI
Handlers -- MQ

' External systems
DBI --> Vitess : mysql
SI --> S3Terms : terms metadata
SI --> S3Statements : statement content
SI --> S3References : reference content
SI --> S3Qualifiers : qualifier content
SI --> S3Revisions : revision data
Workers --> S3Dumps : entity dumps
MQ --> Kafka : events
Config --> API : configuration
Config --> Workers : configuration

@enduml